{% set is_enabled = (abs_settings.enabled if abs_settings else False) %}
<div class="card shadow-sm">
  <div class="card-header d-flex align-items-center justify-content-between">
    <h5 class="mb-0"><i class="bi bi-soundwave me-2"></i>Audiobookshelf</h5>
    {% if not is_enabled %}
      <span class="badge bg-secondary">Disabled by Admin</span>
    {% endif %}
  </div>
  <div class="card-body">
    {% if not is_enabled %}
      <div class="alert alert-warning small">Audiobookshelf sync is disabled by the administrator.</div>
    {% endif %}
    <form method="POST" action="{{ url_for('auth.settings_personal_abs_partial') }}" hx-post="{{ url_for('auth.settings_personal_abs_partial') }}" hx-target="#personalDynamicContainer" hx-swap="innerHTML">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
      <div class="row g-3">
        <div class="col-md-4">
          <label class="form-label">ABS Username</label>
          <input type="text" name="abs_username" class="form-control" value="{{ settings.abs_username or '' }}" placeholder="Your ABS username" {% if not is_enabled %}disabled{% endif %} />
          <small class="text-muted">Used for display and optional matching.</small>
        </div>
        <div class="col-md-4">
          <label class="form-label">Personal API Key</label>
          <input type="password" name="abs_api_key" class="form-control" value="{{ settings.abs_api_key or '' }}" autocomplete="off" placeholder="Your ABS API token" {% if not is_enabled %}disabled{% endif %} />
          <small class="text-muted">Stored only for your account.</small>
        </div>
        <div class="col-md-4">
          <label class="form-label">What to sync</label>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="abs_sync_books" name="abs_sync_books" {% if settings.abs_sync_books %}checked{% endif %} {% if not is_enabled %}disabled{% endif %}>
            <label class="form-check-label" for="abs_sync_books">Books (imports/updates)</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="abs_sync_listening" name="abs_sync_listening" {% if settings.abs_sync_listening %}checked{% endif %} {% if not is_enabled %}disabled{% endif %}>
            <label class="form-check-label" for="abs_sync_listening">Listening sessions</label>
          </div>
        </div>
      </div>
      <div class="mt-3">
        <button class="btn btn-primary" {% if not is_enabled %}disabled{% endif %}><i class="bi bi-save"></i> Save ABS Settings</button>
      </div>
    </form>
    <div class="mt-3 small text-muted">Note: Only admins can start ABS syncs. Your preferences control what gets synced for you when an admin runs a sync.</div>
  </div>
</div>
