{% extends "onboarding/base_onboarding.html" %}

{% block title %}Site Configuration - MyBibliotheca{% endblock %}

{% block progress_width %}40%{% endblock %}

{% block step_info %}Step 2 of 5: Site Configuration{% endblock %}

{% block content %}
<div class="form-header">
    <div class="icon-circle" style="background: linear-gradient(135deg, #17a2b8, #138496);">
        <i class="bi bi-gear-fill"></i>
    </div>
    <h2>Customize Your Installation</h2>
    <p>These settings can be changed later in the admin panel.</p>
</div>

<form method="POST" class="needs-validation" novalidate>
    <!-- CSRF Token -->
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
    
    <!-- Site Name Field -->
    <div class="form-group">
        <label for="site_name" class="form-label">
            <i class="bi bi-house-heart"></i>
            Site Name
        </label>
        <input type="text" 
               id="site_name" 
               name="site_name" 
               class="form-control" 
               value="{{ current_config.get('site_name', 'MyBibliotheca') }}" 
               placeholder="e.g., John's Library, Family Library"
               tabindex="1">
        <div class="form-text">This will appear as the title of your library</div>
    </div>
    
    <!-- Timezone Field -->
    <div class="form-group">
        <label for="timezone" class="form-label">
            <i class="bi bi-clock me-1"></i>
            Timezone
        </label>
        <select id="timezone" 
                name="timezone" 
                class="form-control" 
                tabindex="2">
            {% for tz in timezones %}
                <option value="{{ tz }}" 
                        {% if tz == current_config.get('timezone', 'UTC') %}selected{% endif %}>
                    {{ tz }}
                </option>
            {% endfor %}
        </select>
        <div class="form-text">Used for displaying dates and reading logs</div>
    </div>
    
    <!-- Default Location Field -->
    <div class="form-group">
        <label for="location" class="form-label">
            <i class="bi bi-geo-alt me-1"></i>
            Default Location 
            <span class="badge bg-secondary ms-1" style="font-size: 0.7rem;">Optional</span>
        </label>
        <input type="text" 
               id="location" 
               name="location" 
               class="form-control" 
               value="{{ current_config.get('location', '') }}" 
               placeholder="e.g., Home Library, Study Room"
               tabindex="3">
        <div class="form-text">Set a default location for your books and reading logs</div>
    </div>
    
    <!-- Location Auto-assign Checkbox -->
    <div class="form-group">
        <div class="form-check">
            <input type="checkbox" 
                   class="form-check-input" 
                   id="location_set_as_default" 
                   name="location_set_as_default"
                   {% if current_config.get('location_set_as_default') %}checked{% endif %}
                   tabindex="4">
            <label class="form-check-label" for="location_set_as_default">
                Auto-assign location to new books
            </label>
            <div class="form-text">
                If enabled, this location will be automatically assigned to all books added to your library
            </div>
        </div>
    </div>
    
    <!-- Navigation Buttons -->
    <div class="navigation-buttons">
        <a href="{{ url_for('onboarding.step', step_num=1) }}" 
           class="btn btn-outline-secondary" 
           tabindex="6">
            <i class="bi bi-arrow-left me-2"></i>Back
        </a>
        <button type="submit" 
                class="btn btn-primary" 
                tabindex="5">
            Continue to Data Options<i class="bi bi-arrow-right ms-2"></i>
        </button>
    </div>
</form>
{% endblock %}

{% block scripts %}
<script>
// Auto-detect timezone
document.addEventListener('DOMContentLoaded', function() {
    const timezoneSelect = document.getElementById('timezone');
    const currentValue = timezoneSelect.value;
    
    // Only auto-detect if no timezone is already set
    if (!currentValue || currentValue === 'UTC') {
        try {
            const userTimezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
            if (userTimezone) {
                const option = timezoneSelect.querySelector(`option[value="${userTimezone}"]`);
                if (option) {
                    option.selected = true;
                }
            }
        } catch (e) {
            console.log('Timezone auto-detection not supported');
        }
    }
});
</script>
{% endblock %}
